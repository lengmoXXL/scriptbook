# Scriptbook 更新日志

所有版本变更的完整记录。

## [1.6.2] - 2026-01-16

### ✨ 新增功能

- **终端输出迁移为弹窗**
  - 新增 `TerminalModal.vue` 终端弹窗组件
  - 脚本执行在独立弹窗中进行，支持全屏交互
  - 主题切换时终端颜色自动跟随变化
  - 使用 CSS 变量实现灵活的终端样式管理

- **Markdown 内容获取 API**
  - 新增 `/api/files/{name}/content` 端点
  - 支持直接获取 Markdown 文件内容

### 🔧 技术改进

- **前端技术栈升级**
  - 重构 `App.vue`，使用 Vue 3 组合式 API
  - 终端管理逻辑迁移至 TerminalModal 组件
  - 简化终端管理器代码

- **构建系统优化**
  - Vite 配置新增自动复制插件目录功能
  - 开发模式下自动监听并同步插件文件
  - 统一使用 Vite 构建产物

### 🧪 测试增强

- 新增 Playwright 端到端测试 (`test/e2e.test.mjs`)
- 新增 Playwright 集成测试 (`test/integration.test.mjs`)
- 测试覆盖脚本执行、交互输入、主题切换等场景
- 总测试数更新为 200+ 个

## [1.6.1] - 2025-12-29

### ⚡ 性能优化

- **默认超时时间提升至 30 分钟**
  - 脚本执行默认超时从 30 秒调整为 30 分钟
  - 支持长时间运行的脚本任务

## [1.6.0] - 2025-12-26

### ✨ 新增功能

- **新增 GitHub Dark 主题**
  - 新增 GitHub Dark 风格暗色主题
  - 终端配色与暗色主题完美适配

### 🔧 技术改进

- **主题精简**
  - 移除默认的 light/dark 主题
  - 仅保留 GitHub 风格主题

- **目录重命名**
  - `content/` 目录重命名为 `examples/`
  - 更清晰地表达示例文档用途

### 🐛 错误修复

- 测试修复：硬编码 fd=5 导致终端设备错误
- 移除脚本输入内容的回显显示

### 🧪 测试增强

- 新增真实 fd 创建替代模拟
- 73 个 Python 测试全部通过

## [1.5.1] - 2025-12-26

### 🎨 界面改进

- **终端输出框滚动条优化**
  - 修复多个滚动条显示问题
  - 终端输出框现在只显示一个滚动条
  - 终端内容自适应扩展，高度达到 400px 时启用滚动

## [1.5.0] - 2025-12-25

### ✨ 新增功能

- **新主题：GitHub 风格**
  - 新增 GitHub 风格主题，与 GitHub Markdown 渲染一致
  - 优化代码块、表格、引用块等样式

- **终端主题集成**
  - 终端配色与主题风格一致
  - 终端主题配置通过插件 manifest.json 管理

### 🔧 技术改进

- **主题系统重构**
  - 统一主题命名规范（theme-light、theme-dark、theme-github）
  - 插件系统支持终端主题配置

### 🏗️ 界面改进

- **导航栏优化**
  - 顶部导航栏布局，整合文件选择和主题切换
  - 移除独立的控制栏区域
  - 添加 GitHub 仓库链接图标

### 📚 代码清理

- 删除 "Markdown预览" 标题
- 简化页脚内容

## [1.4.4] - 2025-12-25

### 🔧 技术改进

- **Python 3.10 兼容性修复**
  - 使用 `asyncio.wait_for` 替代 `asyncio.timeout`
  - 修复 async generator 超时处理

## [1.4.3] - 2025-12-25

### ✨ 新增功能

- **PTY 支持**
  - 修复 Python 3.10~3.14 兼容性问题
  - 使用 `pty.openpty()` 替代被移除的 `pty` 参数
  - 支持 `tty` 命令和需要 TTY 的命令（如 `docker exec -it`）

### 🔧 代码重构

- 重构 `script_executor.py`
  - 提取 `_cleanup()` 方法简化资源清理
  - 使用 `asyncio.wait_for` 替代 `asyncio.timeout` 以支持 Python 3.10

### 🧪 测试增强

- 新增 TTY 命令集成测试

## [1.4.2] - 2025-12-24

### 🎨 界面改进

- **xterm.js Canvas 渲染器**
  - 从 DOM 渲染器切换到 Canvas 渲染器
  - 解决滚动问题，提供更流畅的滚动体验
  - 终端背景与页面主题保持一致
  - 主题切换时终端自动跟随变色

### 🐛 错误修复

- 修复 xterm.css 问题，下载正确样式文件
- 修复 xterm.js 背景灰色问题
- 修复主题切换时终端颜色不变的问题
- 修复暗色主题下终端初始化为白色的问题

### 📚 代码清理

- 移除废弃样式和调试代码

## [1.4.1] - 2025-12-24

### 🐛 错误修复

- **Docker 命令支持**
  - 添加 `pty=True` 参数，支持 `docker exec` 等需要 TTY 的命令
  - 修复 "the input device is not tty" 错误

## [1.4.0] - 2025-12-24

### ✨ 新增功能

- **xterm.js 嵌入式终端**
  - 使用专业终端模拟器渲染脚本输出
  - 支持完整的 ANSI 转义序列解析
  - 提供更好的终端体验（滚动、选择、复制）
  - 浅色主题适配（#f5f5f5 背景 + #333333 文字）
  - 颜色编码：stdout 无色、stderr 红色、stdin 青色、exit 黄色

### 🔧 技术改进

- 新增 `terminal-manager.js` - 终端管理器类
  - 管理多个终端实例
  - 支持主题切换
  - 持久化内容获取
- 新增 `lib/xterm.js` 和 `lib/xterm.css` - xterm.js 库文件
- 移除废弃的 `ansi-html.js` 和 `ansi-parser.js`
- 终端输出区域 CSS 优化
  - 隐藏 scroll-area 黑框
  - 正确处理 overflow 和滚动条

### 🧪 测试增强

- 新增 26 个 TerminalManager 单元测试
- 更新 83 个现有测试以适配新实现
- 总测试数更新为 109 个（JS）+ 70 个（Python）+ 13 个（集成）

## [1.3.1] - 2025-12-23

### 🐛 错误修复

- **主题持久化**: 刷新页面保持当前选择的主题
- **文档持久化**: 刷新页面保持当前选择的文档
- **浏览器缓存**: JS/CSS 添加版本号 `?v=2` 防止缓存导致的问题

### 🔧 代码优化

- 移除冗余 import 语句
- 添加 `_timestamp()` 辅助函数，避免重复代码
- 修复 bare except 为具体异常处理
- 插件管理器添加缓存 TTL (60 秒)
- 优化 `get_plugin` 查找逻辑

### 🧪 测试增强

- 新增 3 个 Python 回归测试（markdown 渲染相关）
- 新增 16 个 JavaScript 测试（持久化功能）
- 总测试数更新为 86 个（70 Python + 16 JS）

## [1.3.0] - 2025-12-22

### ✨ 新增功能

- **ANSI 转义序列解析**
  - 脚本输出的颜色和格式在浏览器中正确显示
  - 支持 `\x1b[`、`\033[` 和 `[` 格式的 ANSI 序列
  - 支持 16 种基础颜色（黑、红、绿、黄、蓝、紫、青、白）
  - 支持粗体、斜体、下划线、反色等格式效果
  - 自动检测并转换 ANSI 序列为 HTML

### 🎨 界面改进

- **按钮布局优化**
  - 所有操作按钮移至脚本块头部同一行
  - 执行按钮（绿色）+ 复制按钮（蓝色）+ 停止按钮（红色）
  - 统一按钮样式和间距
  - 响应式布局，移动端自适应换行

- **输出区域优化**
  - 移除输出行之间的水平分隔线
  - 极紧凑的行间距（垂直 padding: 0）
  - 时间戳与内容水平对齐（baseline 对齐）
  - 优化字体大小和边距，提升可读性

### 📚 文档更新

- 新增 `content/ansi_examples.md` - 15+ 个 ANSI 使用示例
  - 基本颜色示例（红、绿、黄、蓝）
  - 带格式的颜色示例（粗体、下划线、反色）
  - 构建过程示例（模拟真实项目构建）
  - 高级格式化示例（256 色、RGB 色）
- 更新 `content/example.md` - 添加 ANSI 颜色演示

### 🧪 测试增强

- 新增 15 个 JavaScript 测试
- 总测试数更新为 153 个

## [1.2.0] - 2025-12-22

### 📚 文档体系

- 新增 RELEASE.md - 规范化代码整理和发布流程
- 优化项目结构 - 清理开发过程文档，创建完整文档体系
- 完善文档系统 - 添加 CLAUDE.md、CHANGELOG.md、RELEASE_PROCESS.md
- 简化发布流程 - 优化 RELEASE_PROCESS.md 使其更简洁易用
- 改进开发体验 - 提供清晰的项目结构和操作指南

## [1.1.0] - 2025-12-22

### ✨ 新增功能

- **脚本结果持久化**
  - 页面刷新后自动恢复脚本执行结果（使用 localStorage）
  - 每个文档的结果独立保存

- **停止脚本执行**
  - 点击红色停止按钮立即终止正在执行的脚本
  - 显示 "=== 脚本已被用户停止 ===" 提示

- **WebSocket 并发优化**
  - 改进连接处理，支持页面刷新场景
  - 更好的错误处理和资源清理

### 🐛 错误修复

- 修复 WebSocket "Unexpected ASGI message" 错误
- 修复停止按钮不可见问题
- 改进异常处理和资源清理

### 🧪 测试增强

- 新增 25 个 JavaScript 测试用例
- 新增测试文件：
  - `script-results-persistence.test.js` - 结果持久化测试
  - `script-results-persistence-integration.test.js` - 集成测试
  - `websocket-concurrency.test.js` - 并发处理测试
  - `script-stop-functionality.test.js` - 停止功能测试

### 🎨 界面改进

- 停止按钮：红色背景 + 白色边框，清晰可见
- 按钮状态：执行时启用，停止后恢复
- 视觉反馈：显示 "=== 脚本已被用户停止 ==="

## [1.0.0] - 2025-12-21

### ✨ 初始版本

- 项目重命名为 Scriptbook
- 交互式输入功能（stdin 支持）
- WebSocket 实时输出流
- 多文档支持
- 主题切换（明亮/暗色）
- 25 个 JavaScript 单元测试
- 64 个 Python 单元测试
- 13 个集成测试

---

## 测试覆盖率详情

### JavaScript 测试 (109 个)

| 测试模块 | 数量 |
|---------|------|
| App 类测试 | 25 |
| TerminalManager 测试 | 26 |
| 插件加载器测试 | 16 |
| 脚本结果持久化测试 | 9 |
| 脚本结果持久化集成测试 | 7 |
| WebSocket 并发测试 | 8 |
| 脚本停止功能测试 | 12 |

### Python 测试 (70 个)

| 测试模块 | 数量 |
|---------|------|
| 文件扫描 | 15 |
| Markdown 解析 | 20 |
| 插件管理 | 15 |
| 脚本执行 | 14 |

### 集成测试 (13 个)

- WebSocket 集成测试
- 端到端测试

### Playwright 测试

- `test/e2e.test.mjs` - 端到端测试
- `test/integration.test.mjs` - 集成测试

**总测试数：200+ 个，全部通过**

## 贡献者

- **lzy** - 初始开发和所有功能实现

## 许可证

MIT License
